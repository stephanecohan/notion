<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Compte à rebours</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial;
  background:#fff;color:#191919;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  min-height:100vh;padding:20px;
  transition:background .3s,color .3s;
}

/* --- conteneur principal --- */
.timer-container{
  position:relative;width:300px;height:300px;
  display:flex;align-items:center;justify-content:center;
}

/* --- Cercle de progression --- */
.progress-ring{
  position:absolute;inset:0;
  transform:rotate(-90deg);
  width:100%;height:100%;
}
.progress-ring__bg{
  fill:none;stroke:#eee;stroke-width:2;
}
.progress-ring__circle{
  fill:none;stroke:#007aff;stroke-width:4;stroke-linecap:round;
  transition:stroke-dashoffset 1s linear;
}

/* --- Animation arc-en-ciel tournante à la fin --- */
@keyframes rainbow-rotate {
  0% { stroke: url(#grad1); transform: rotate(0deg); }
  100% { stroke: url(#grad1); transform: rotate(360deg); }
}
.rainbow-animate {
  animation: rainbow-rotate 2s linear infinite;
  transform-origin: 50% 50%;
}

/* --- affichage du temps --- */
.time-wrapper{
  position:relative;
  display:flex;align-items:center;justify-content:center;
  gap:0px;z-index:2;
}
.time-group{
  display:flex;flex-direction:column;align-items:center;min-width:60px;
}
.btn-up,.btn-down{
  width:34px;height:34px;border:none;border-radius:10px;
  background:#f1f1f1;cursor:pointer;font-size:18px;font-weight:400;
  transition:all .15s ease;
}
.btn-up:hover,.btn-down:hover{background:#e0e0e0}
.time-value{
  font-size:38px;font-weight:600;text-align:center;width:55px;color:#111;
}
.separator{font-size:30px;color:#888;font-weight:600;}

/* --- Contrôles sous le cercle --- */
.controls{
  margin-top:24px;
  display:flex;gap:20px;align-items:center;justify-content:center;
}
.icon-btn{
  width:50px;height:50px;border:none;border-radius:14px;
  background:#f1f1f1;color:#111;cursor:pointer;
  font-size:22px;display:flex;align-items:center;justify-content:center;
  transition:all .15s ease;
}
.icon-btn:hover{background:#e0e0e0;transform:translateY(0px);}
.icon-btn:disabled{opacity:.3;cursor:not-allowed;transform:none;}

/* --- Dark mode --- */
@media(prefers-color-scheme:dark){
  body{background:#191919;color:#eee}
  .progress-ring__bg{stroke:#333}
  .progress-ring__circle{stroke:#0a84ff}
  .btn-up,.btn-down,.icon-btn{background:#222;color:#eee}
  .btn-up:hover,.btn-down:hover,.icon-btn:hover{background:#333}
  .time-value{color:#fff}
}
</style>
</head>
<body>

<div class="timer-container">
  <svg class="progress-ring" viewBox="0 0 300 300">
    <!-- Dégradé arc-en-ciel -->
    <defs>
      <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="0%">
        <stop offset="0%" stop-color="#ff0000"/>
        <stop offset="16%" stop-color="#ff7f00"/>
        <stop offset="33%" stop-color="#ffff00"/>
        <stop offset="50%" stop-color="#00ff00"/>
        <stop offset="66%" stop-color="#0000ff"/>
        <stop offset="83%" stop-color="#8b00ff"/>
        <stop offset="100%" stop-color="#ff0000"/>
      </linearGradient>
    </defs>

    <circle class="progress-ring__bg" cx="150" cy="150" r="130"></circle>
    <circle class="progress-ring__circle" id="ring" cx="150" cy="150" r="130"></circle>
  </svg>

  <div class="time-wrapper">
    <div class="time-group">
      <button class="btn-up" id="hoursUp">+</button>
      <div class="time-value" id="hours">00</div>
      <button class="btn-down" id="hoursDown">−</button>
    </div>
    <div class="separator">:</div>
    <div class="time-group">
      <button class="btn-up" id="minutesUp">+</button>
      <div class="time-value" id="minutes">00</div>
      <button class="btn-down" id="minutesDown">−</button>
    </div>
    <div class="separator">:</div>
    <div class="time-group">
      <button class="btn-up" id="secondsUp">+</button>
      <div class="time-value" id="seconds">00</div>
      <button class="btn-down" id="secondsDown">−</button>
    </div>
  </div>
</div>

<!-- Contrôles -->
<div class="controls">
  <button class="icon-btn" id="startBtn" title="Démarrer">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
      <polygon points="5 3 19 12 5 21 5 3"></polygon>
    </svg>
  </button>
  <button class="icon-btn" id="pauseBtn" title="Pause" disabled>
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
      <rect x="6" y="4" width="4" height="16"></rect>
      <rect x="14" y="4" width="4" height="16"></rect>
    </svg>
  </button>
  <button class="icon-btn" id="resetBtn" title="Réinitialiser">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="23 4 23 10 17 10"></polyline>
      <polyline points="1 20 1 14 7 14"></polyline>
      <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
    </svg>
  </button>
</div>

<script>
const hoursEl=document.getElementById("hours"),
      minutesEl=document.getElementById("minutes"),
      secondsEl=document.getElementById("seconds"),
      ring=document.getElementById("ring");

const RADIUS=130;
const CIRC=2*Math.PI*RADIUS;
ring.style.strokeDasharray=CIRC;
ring.style.strokeDashoffset=0; // pleine au départ

let totalSeconds=0,remainingSeconds=0,isRunning=false,timerInterval=null;

/* --- MAJ affichage --- */
function updateDisplay(){
  const h=Math.floor(remainingSeconds/3600),
        m=Math.floor((remainingSeconds%3600)/60),
        s=remainingSeconds%60;
  hoursEl.textContent=String(h).padStart(2,"0");
  minutesEl.textContent=String(m).padStart(2,"0");
  secondsEl.textContent=String(s).padStart(2,"0");
  updateRing();
  if(remainingSeconds===0 && isRunning){
    pauseTimer();
    playBell();
    rainbowEffect();
    resetTimer();
  }
}

/* --- cercle de progression --- */
function updateRing(){
  if(totalSeconds<=0){ring.style.strokeDashoffset=0;return;}
  const progress=remainingSeconds/totalSeconds;
  ring.style.strokeDashoffset=CIRC*(1-progress);
}

/* --- réglage temps --- */
function adjustTime(unit,delta){
  if(isRunning)return;
  let h=Math.floor(remainingSeconds/3600),
      m=Math.floor((remainingSeconds%3600)/60),
      s=remainingSeconds%60;
  if(unit==="hours")h=Math.max(0,Math.min(99,h+delta));
  if(unit==="minutes"){m+=delta;if(m>=60){m=0;h++;}else if(m<0){m=59;h--;}}
  if(unit==="seconds"){s+=delta;if(s>=60){s=0;m++;}else if(s<0){s=59;m--;}}
  remainingSeconds=Math.max(0,h*3600+m*60+s);
  totalSeconds=remainingSeconds;
  updateDisplay();
}

/* --- boutons + - --- */
document.getElementById("hoursUp").onclick=()=>adjustTime("hours",1);
document.getElementById("hoursDown").onclick=()=>adjustTime("hours",-1);
document.getElementById("minutesUp").onclick=()=>adjustTime("minutes",1);
document.getElementById("minutesDown").onclick=()=>adjustTime("minutes",-1);
document.getElementById("secondsUp").onclick=()=>adjustTime("seconds",1);
document.getElementById("secondsDown").onclick=()=>adjustTime("seconds",-1);

/* --- boutons de contrôle --- */
const startBtn=document.getElementById("startBtn"),
      pauseBtn=document.getElementById("pauseBtn"),
      resetBtn=document.getElementById("resetBtn");

function startTimer(){
  if(remainingSeconds<=0)return;
  isRunning=true;
  startBtn.disabled=true;pauseBtn.disabled=false;
  ring.classList.remove("rainbow-animate");
  timerInterval=setInterval(()=>{
    if(remainingSeconds>0){remainingSeconds--;updateDisplay();}
  },1000);
}
function pauseTimer(){
  isRunning=false;
  clearInterval(timerInterval);
  startBtn.disabled=false;pauseBtn.disabled=true;
}
function resetTimer(){
  pauseTimer();
  remainingSeconds=totalSeconds;
  updateDisplay();
}

startBtn.onclick=startTimer;
pauseBtn.onclick=pauseTimer;
resetBtn.onclick=resetTimer;

// 7. SONNETTE JOUET - Fun et léger
function playBell(){
  const ctx=new(window.AudioContext||window.webkitAudioContext)();
  const dur=2;
  function tone(f,delay=0,vol=0.25){
    const o=ctx.createOscillator(),g=ctx.createGain();
    o.type="triangle";
    o.frequency.value=f;o.connect(g);g.connect(ctx.destination);
    const t=ctx.currentTime+delay;
    g.gain.setValueAtTime(vol,t);
    g.gain.exponentialRampToValueAtTime(.001,t+dur);
    o.start(t);o.stop(t+dur);
  }
  tone(1047, 0);
  tone(1319, 0.15);
  tone(1568, 0.3);
  tone(2093, 0.45);
  tone(1568, 0.7);
  tone(1319, 0.85);
  tone(1047, 1.0);
}

/* --- Animation arc-en-ciel circulaire à la fin --- */
function rainbowEffect(){
  ring.classList.add("rainbow-animate");
  ring.style.stroke="url(#grad1)";
  setTimeout(()=>{
    ring.classList.remove("rainbow-animate");
    ring.style.stroke="#007aff";
  },10000);
}

/* --- init --- */
updateDisplay();
</script>
</body>
</html>
